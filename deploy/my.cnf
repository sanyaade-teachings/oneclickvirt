[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_general_ci
explicit_defaults_for_timestamp=true
lower_case_table_names=1

# ===== 性能优化参数 (兼容 MySQL 5.x/8.x 和 MariaDB 10.x) =====

# InnoDB 缓冲池（建议设为物理内存的50-70%）
innodb_buffer_pool_size=1G

# InnoDB 日志文件大小
# MySQL 8.0.30+ 已废弃此参数，但仍接受（会被忽略）
# MySQL 5.x/8.0早期版本和 MariaDB 仍需要此参数
innodb_log_file_size=256M

# 事务提交时的日志刷新策略
# 0=每秒刷新(最快但可能丢数据) 1=每次提交刷新(最安全但最慢) 2=每次提交写入但每秒刷新(平衡)
innodb_flush_log_at_trx_commit=2

# InnoDB 刷新方法（减少双写缓冲）
# 注意：Windows 不支持 O_DIRECT，会自动降级
innodb_flush_method=O_DIRECT

# 最大连接数
max_connections=500

# 线程缓存大小
thread_cache_size=100

# Query Cache 配置（仅 MySQL 5.x 和 MariaDB 10.x 支持）
# MySQL 8.0+ 已完全移除 Query Cache，设置这些参数会导致启动失败
# 因此注释掉，让各版本使用默认值
# query_cache_type=0
# query_cache_size=0

# 临时表优化
tmp_table_size=64M
max_heap_table_size=64M

# 连接超时设置（10分钟）
wait_timeout=600
interactive_timeout=600

# 慢查询日志（建议在生产环境中启用以诊断性能问题）
# slow_query_log=1
# slow_query_log_file=/var/log/mysql/slow-query.log
# long_query_time=2

# ===== 兼容性说明 =====
# 本配置文件兼容：
# - MySQL 5.7+
# - MySQL 8.0+ (包括8.0.30+新版本)
# - MariaDB 10.x+
# 
# 注意事项：
# 1. innodb_buffer_pool_size 请根据实际服务器内存调整
# 2. 如需启用 Query Cache (仅MariaDB)，可手动取消注释相关配置
# 3. 慢查询日志路径需确保 MySQL 进程有写入权限

[client]
default-character-set=utf8mb4

[mysql]
default-character-set=utf8mb4